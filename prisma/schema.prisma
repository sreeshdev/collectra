// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum UserRole {
  ADMIN
  EMPLOYEE
}

enum RecurringType {
  MONTHLY
  BIMONTHLY
}

enum TransactionType {
  manual
  payment_link
  online
}

enum TransactionStatus {
  pending
  paid
  failed
}

model User {
  id               String    @id @default(uuid())
  role             UserRole  @default(EMPLOYEE)
  name             String
  mobile           String    @unique
  email            String
  address          String?
  passwordHash     String    @map("password_hash")
  displayPictureUrl String?  @map("display_picture_url")
  createdAt        DateTime  @default(now()) @map("created_at")
  
  // Relations
  assignedCustomers Customer[] @relation("AssignedEmployee")
  transactions      Transaction[]
  
  @@map("users")
}

model Package {
  id            String        @id @default(uuid())
  name          String
  price         Decimal       @db.Decimal(10, 2)
  recurringType RecurringType @map("recurring_type")
  createdAt     DateTime      @default(now()) @map("created_at")
  
  // Relations
  customers     Customer[]
  
  @@map("packages")
}

model Customer {
  id                String    @id @default(uuid())
  name              String
  mobile            String
  email             String?
  address           String?
  whatsappMobile    String    @map("whatsapp_mobile")
  boxNumber         String    @unique @map("box_number")
  idNumber          String?   @map("id_number")
  packageId         String    @map("package_id")
  assignedEmployeeId String?  @map("assigned_employee_id")
  pendingBalance    Decimal   @default(0) @map("pending_balance") @db.Decimal(10, 2)
  lastBillingDate   DateTime? @map("last_billing_date")
  createdAt         DateTime  @default(now()) @map("created_at")
  
  // Relations
  package           Package   @relation(fields: [packageId], references: [id])
  assignedEmployee  User?     @relation("AssignedEmployee", fields: [assignedEmployeeId], references: [id])
  transactions      Transaction[]
  
  @@map("customers")
}

model Transaction {
  id              String            @id @default(uuid())
  customerId      String            @map("customer_id")
  transactionId   String            @map("transaction_id")
  transactionDate DateTime          @default(now()) @map("transaction_date")
  transactionType TransactionType   @map("transaction_type")
  transactionBy   String            @map("transaction_by")
  amount          Decimal           @db.Decimal(10, 2)
  status          TransactionStatus @default(pending)
  remarks         String?
  createdAt       DateTime          @default(now()) @map("created_at")
  
  // Relations
  customer        Customer          @relation(fields: [customerId], references: [id])
  user            User              @relation(fields: [transactionBy], references: [id])
  
  @@map("transactions")
}

model PaymentLink {
  id            String    @id @default(uuid())
  customerId    String    @map("customer_id")
  razorpayLinkId String   @map("razorpay_link_id")
  shortUrl      String?   @map("short_url")
  status        String    @default("pending")
  createdAt     DateTime  @default(now()) @map("created_at")
  
  @@map("payment_links")
}

